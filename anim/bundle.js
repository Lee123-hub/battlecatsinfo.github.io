(()=>{"use strict";var t={n:i=>{var s=i&&i.t?()=>i.default:()=>i;return t.d(s,{a:s}),s},d:(i,s)=>{for(var e in s)t.i(s,e)&&!t.i(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:s[e]})},i:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};class i{static h=new i;o;canvas;l;position;u;m;p;g;v;M;_=new Float32Array(16);$;P;I;A;F;L;static k(t){var i=t.toString();switch(i.length){case 3:return i;case 2:return"0"+i;default:return"00"+i}}T(t,i,s,e,h,n){this._[0]=2/(i-t),this._[1]=0,this._[2]=0,this._[3]=0,this._[4]=0,this._[5]=2/(e-s),this._[6]=0,this._[7]=0,this._[8]=0,this._[9]=0,this._[10]=2/(h-n),this._[11]=0,this._[12]=(t+i)/(t-i),this._[13]=(s+e)/(s-e),this._[14]=(h+n)/(h-n),this._[15]=1}scale(t,i){this._[0]*=t,this._[1]*=t,this._[2]*=t,this._[3]*=t,this._[4]*=i,this._[5]*=i,this._[6]*=i,this._[7]*=i}translate(t,i){this._[12]=this._[0]*t+this._[4]*i+this._[8]+this._[12],this._[13]=this._[1]*t+this._[5]*i+this._[9]+this._[13],this._[14]=this._[2]*t+this._[6]*i+this._[10]+this._[14],this._[15]=this._[3]*t+this._[7]*i+this._[11]+this._[15]}}class s{static h=new s;N=new Float32Array(8);B;D;R=!1;S;C;U;O;H=0;X=0;Y=new Float32Array(8);Z(){this.S=i.h.canvas.width,this.C=0,this.O=i.h.canvas.height,this.U=0,this.R=!0}q(){this.R=!1,this.S=this.S-10,this.C=this.C+10,this.O=this.O-10,this.U=this.U+10}G(t){var s=i.h.l;switch(t){case 0:s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.uniform1i(i.h.v,1);break;case 1:s.blendFunc(s.ONE,s.ONE),s.uniform1i(i.h.v,1);break;case 2:s.blendFunc(s.ZERO,s.SRC_COLOR),s.uniform1i(i.h.v,1);break;case 3:s.blendFunc(s.ONE_MINUS_DST_COLOR,s.ONE),s.uniform1i(i.h.v,2)}}W(t,s,e,h,n,o,a,r,c,l,u,f,d){if(this.R)this.S=Math.min(s,h,o,r,this.S),this.C=Math.max(s,h,o,r,this.C),this.O=Math.min(e,n,a,c,this.O),this.U=Math.max(e,n,a,c,this.U);else{var m=i.h.l;this.N[0]=s-this.H,this.N[1]=e-this.X,this.N[2]=h-this.H,this.N[3]=n-this.X,this.N[4]=r-this.H,this.N[5]=c-this.X,this.N[6]=o-this.H,this.N[7]=a-this.X,m.bindBuffer(m.ARRAY_BUFFER,i.h.u),m.bufferData(m.ARRAY_BUFFER,this.N,m.STATIC_DRAW),this.N[0]=l,this.N[1]=u,this.N[2]=l,this.N[3]=u+d,this.N[4]=l+f,this.N[5]=u,this.N[6]=l+f,this.N[7]=u+d;for(let i=0;i<8;)this.N[i++]/=t.j,this.N[i++]/=t.V;m.bindBuffer(m.ARRAY_BUFFER,i.h.p),m.bufferData(m.ARRAY_BUFFER,this.N,m.STATIC_DRAW),m.bindTexture(m.TEXTURE_2D,t.K),m.drawArrays(m.TRIANGLE_STRIP,0,4)}}J(){var t=i.h.l;t.bindBuffer(t.ARRAY_BUFFER,i.h.u),t.vertexAttribPointer(i.h.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i.h.position),t.bindBuffer(t.ARRAY_BUFFER,i.h.p),t.vertexAttribPointer(i.h.m,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i.h.m),t.bindBuffer(t.ARRAY_BUFFER,i.h.p),t.bufferData(t.ARRAY_BUFFER,this.N,t.STATIC_DRAW),t.enable(t.BLEND),t.uniform3f(i.h.$,70/255,140/255,160/255),t.uniform3f(i.h.P,45/255,90/255,90/255)}setAlpha(t){i.h.l.uniform1f(i.h.g,t)}tt(){var t=i.h.l;t.blendFunc(t.ONE,t.ZERO),t.bindBuffer(t.ARRAY_BUFFER,i.h.u),t.bufferData(t.ARRAY_BUFFER,this.Y,t.STATIC_DRAW),t.uniform1i(i.h.v,3),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}class e{x;y;width;height}class h{a;b;it=0;st(t){return parseInt(this.b[t])}async et(t){t=await fetch(t);if(!t.ok)throw"File not found";this.a=await t.text()}ht(t){return this.b[t]}nt(){var t;return this.it>=this.a.length?null:(t=this.it,this.it=this.a.indexOf("\n",t),-1==this.it?(this.it=this.a.length,this.a.slice(t)):(t=this.a.slice(t,this.it++)).includes("\r")?t.replaceAll("\r",""):t)}ot(t=","){var i=this.nt();return i&&(this.b=i.split(t)),this.b}c(){return this.a}close(){}}class n{K;j;V;name;rt;async load(t,s,n=0){if(this.reset(),null!=s)if(0!=(1&n)){let t=new h,i=(await t.et(s),t.nt(),t.nt(),t.nt(),t.ot(),t.st(0));this.rt=new Array(i);for(let s=0;s<i;s++)t.ot(),this.rt[s].x=t.st(0),this.rt[s].y=t.st(1),this.rt[s].width=t.st(2),this.rt[s].height=t.st(3);t.close()}else{let t=new h,i=(await t.et(s),t.nt(),t.nt(),t.nt(),t.ot(),t.st(0));this.rt=new Array(i);for(let s=0;s<i;s++)t.ot(),this.rt[s]=new e,this.rt[s].x=t.st(0),this.rt[s].y=t.st(1),this.rt[s].width=t.st(2),this.rt[s].height=t.st(3);t.close()}const o=i.h.l,a=document.createElement("img");a.crossOrigin="anonymous",a.src=t,await new Promise(function(t,i){a.onload=t,a.onerror=i}),this.j=a.naturalWidth,this.V=a.naturalHeight,this.K=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.K),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a)}reset(){this.K&&(i.h.l.deleteTexture(this.K),this.K=null)}}class o{frame;ct;lt;ut}class a{ft;dt;loop;wt;gt;vt=0;max=0;yt=0;bt=0;Mt(){if(this.wt&&(this.gt[0].frame<0||-1!=this.loop)){this.vt=-this.gt[0].frame;for(let t=0;t<this.wt;++t)this.gt[t].frame+=this.vt}return this.wt&&(this.yt=this.gt[0].frame,this.max=this.gt[this.wt-1].frame),-1!=this.loop?1<this.loop?this.yt+(this.max-this.yt)*this.loop:this.max-this.vt:this.max-Math.min(this.vt,0)}_t(t){this.wt&&t[this.ft].xt(this.dt,this.gt[this.wt-1].ct)}}class r{$t;Pt;It;async load(t){var i=new h;this.It=0,await i.et(t),i.nt(),i.nt(),i.ot(),this.Pt=i.st(0),this.$t=new Array(this.Pt);for(let t=0;t<this.Pt;t++){i.ot();var s=new a;(this.$t[t]=s).ft=i.st(0),s.dt=i.st(1),s.loop=i.st(2),i.ot(),s.wt=i.st(0),s.gt=new Array(s.wt);for(let t=0;t<s.wt;t++)i.ot(),s.gt[t]=new o,s.gt[t].frame=i.st(0),s.gt[t].ct=i.st(1),s.gt[t].lt=i.st(2),s.gt[t].ut=i.st(3);var e=s.Mt();e>this.It&&(this.It=e)}i.close()}}class c{_=new Float32Array(6);constructor(){this.At()}At(){this._[0]=1,this._[1]=0,this._[2]=0,this._[3]=0,this._[4]=1,this._[5]=0}rotate(t){var i=Math.cos(t*Math.PI/180),s=(t=Math.sin(t*Math.PI/180),this._[0]);this._[0]=this._[0]*i+this._[1]*t,this._[1]=s*-t+this._[1]*i,s=this._[3],this._[3]=this._[3]*i+this._[4]*t,this._[4]=i*this._[4]+(t=-t)*s}setTranslate(t,i){this._[0]=1,this._[1]=0,this._[2]=t,this._[3]=0,this._[4]=1,this._[5]=i}setRotate(t){this._[0]=Math.cos(t*Math.PI/180),this._[1]=-Math.sin(t*Math.PI/180),this._[2]=0,this._[3]=Math.sin(t*Math.PI/180),this._[4]=Math.cos(t*Math.PI/180),this._[5]=0}setScale(t,i){this._[0]=t/100,this._[1]=0,this._[2]=0,this._[3]=0,this._[4]=i/100,this._[5]=0}scale(t,i){this._[0]=this._[0]*t/100,this._[1]=this._[1]*i/100,this._[3]=this._[3]*t/100,this._[4]=this._[4]*i/100}set(t){this._.set(t._)}transform(t,i,s){s.x=~~(this._[0]*t+this._[1]*i+this._[2]),s.y=~~(this._[3]*t+this._[4]*i+this._[5])}translate(t,i){this._[2]=this._[2]+this._[0]*t+this._[1]*i,this._[5]=this._[5]+this._[3]*t+this._[4]*i}mul(t){var i=this._[0],s=t._[0],e=this._[1],h=t._[3],n=this._[2],o=t._[1],a=this._[3],r=t._[4],c=this._[4],l=(t._[2],this._[5]),t=t._[5];this._[0]=i*s+e*h,this._[1]=i*o+e*r,this._[2]=n*s+a*h,this._[3]=n*o+a*r,this._[4]=c*s+l*h,this._[5]=c*o+l*r+t}}class l{x=0;y=0}class u{Ft;Lt;kt;Tt;Nt;Bt;Dt;Rt;St;zt;Ct;Ut;Ot;Ht;Xt;Yt;Zt;qt;Gt;Et;Wt;s;jt;Vt;Kt;Jt;rotation;Qt;alpha;ti;ii;E=new Int32Array(8);si=new l;ei=new c;reset(t,i){this.ti=1,this.ii=1,this.Bt=0,this.Rt=0,this.zt=0,this.Yt=0,this.Xt=0,this.Gt=0,this.Et=0,this.Ut=0,this.Jt=t,this.jt=t,this.Qt=0,this.kt=i}hi(t){let i,s,e;-1<this.Nt+this.Bt?(e=t.$t[this.Nt+this.Bt],this.s=i=~~(this.Wt*this.jt*e.s/t.ni/t.ni),this.Kt=s=~~(this.Vt*this.Jt*e.Kt/t.ni/t.ni),this.Ft=this.Lt=this.alpha*this.kt*e.Ft/t.oi/t.oi):(i=this.Wt*this.jt/t.ni,this.s=i,s=this.Vt*this.Jt/t.ni,this.Kt=s,this.Ft=this.Lt=this.alpha*this.kt/t.oi),-1<this.Dt+this.Rt&&(this.E[0]=this.E[2]=-(this.Zt+this.Gt)*i/t.ni,this.E[4]=this.E[6]=i*t.ai.rt[this.St+this.zt].width/t.ni+this.E[0],this.E[1]=this.E[7]=-(this.qt+this.Et)*s/t.ni,this.E[3]=this.E[5]=s*t.ai.rt[this.St+this.zt].height/t.ni+this.E[1]),e?(this.ei.set(e.ei),this.ei.translate((this.Ot+this.Xt)*e.s/t.ni,(this.Ht+this.Yt)*e.Kt/t.ni)):this.ei.translate(this.Xt,this.Yt),this.ei.rotate(360*(this.rotation+this.Qt)/t.ri);for(let t=0;t<8;t+=2)this.ei.transform(this.E[t],this.E[t+1],this.si),this.E[t]=this.si.x,this.E[t+1]=this.si.y}ci(t,i,s,e){this.ei.transform((i-this.Zt-this.Gt)*this.s/t.ni,(s-this.qt-this.Et)*this.Kt/t.ni,e)}xt(t,i){switch(t){case 0:return void(this.Bt=i-this.Nt);case 1:return void(this.Rt=i-this.Dt);case 2:return void(this.zt=i-this.St);case 3:return void(this.Ut=i-this.Ct);case 4:return void(this.Xt=i);case 5:return void(this.Yt=i);case 6:return void(this.Gt=i);case 7:return void(this.Et=i);case 8:return this.Jt=i,void(this.jt=i);case 9:return void(this.jt=i);case 10:return void(this.Jt=i);case 11:return void(this.Qt=i);case 12:return void(this.kt=i);case 13:return void(this.ti=i?-1:1);case 14:return void(this.ii=i?-1:1)}}li(t,i,s,e){var h;this.Dt<0||this.St<0||(i.G(this.Tt),(h=this.Lt/t.oi)&&(i.setAlpha(h),t=(h=t.ai).rt[this.zt+this.St],i.W(h,this.E[0]+s,this.E[1]+e,this.E[2]+s,this.E[3]+e,this.E[4]+s,this.E[5]+e,this.E[6]+s,this.E[7]+e,t.x,t.y,t.width,t.height)))}}class f{a;b;c;d;e;f;ui}class d{ai;$t;Pt;fi;e;ni;ri;oi;di;mi;pi(t){return this.di[t]}wi(t){this.ai=t}gi(t,i){var e=s.h;for(let s=0;s<this.Pt;s++)this.$t[this.fi[s]].li(this,e,t,i)}vi(t,i,s){let e=i,h=i;for(let s=i-1;0<=s&&3==t[s].lt;s--)e=s;for(let s=i+1;s<t.length&&3==t[h=s].lt;s++);let n=0;for(let i=e;i<=h;i++){let o=4096*t[i].ct;for(let n=e;n<=h;n++)i!=n&&(o*=(s-t[n].frame)/(t[i].frame-t[n].frame));n+=o}return~~(n/4096)}hi(t,i=0){if(!i)for(let t of this.$t)t.reset(this.ni,this.oi);if(t)for(var s of t.$t){const t=s.loop,e=s.max,h=s.yt,n=e-h;let o=-1==t?e?(i+s.vt)%e:0:i+s.vt;if(0<t&&n){if(o>h+t*n){s._t(this.$t);continue}o<=h||(o=o<h+t*n?h+(o-h)%n:e)}for(let t=0;t<s.wt;++t)if(o==s.gt[t].frame)this.$t[s.ft].xt(s.dt,s.bt=s.gt[t].ct);else if(t<s.wt-1&&o>s.gt[t].frame&&o<s.gt[t+1].frame){if(1<s.dt){const i=s.gt[t].frame,e=s.gt[t].ct,h=s.gt[t+1].frame,n=s.gt[t+1].ct;let a=(o-i)/(h-i);if(1==s.gt[t].lt||13==s.dt||14==s.dt)a=0;else if(0!=s.gt[t].lt)if(2==s.gt[t].lt)a=0<=s.gt[t].ut?1-Math.sqrt(1-Math.pow(a,s.gt[t].ut)):Math.sqrt(1-Math.pow(1-a,-s.gt[t].ut));else{if(3==s.gt[t].lt){s.bt=this.vi(s.gt,t,o),this.$t[s.ft].xt(s.dt,s.bt);break}4==s.gt[t].lt&&(a=0<s.gt[t].ut?1-Math.cos(a*Math.PI/2):s.gt[t].ut<0?Math.sin(a*Math.PI/2):(1-Math.cos(a*Math.PI))/2)}2==s.dt?s.bt=n-e<0?Math.ceil((n-e)*a+e):(n-e)*a+e:s.bt=(n-e)*a+e,this.$t[s.ft].xt(s.dt,s.bt=~~s.bt);break}0==s.dt&&this.$t[s.ft].xt(0,s.gt[t].ct)}s.wt&&o>s.max&&s._t(this.$t)}for(let t of this.$t)t.hi(this);for(let t=0;t<this.Pt;t++)this.fi[t]=t,this.e[t]=this.$t[t].Ct+this.$t[t].Ut;for(let t=1;t<this.Pt;t++){let i=this.fi[t],s=this.e[t],e=t-1;for(;0<=e&&this.e[e]>s;)this.fi[e+1]=this.fi[e],this.e[e+1]=this.e[e],e--;this.fi[e+1]=i,this.e[e+1]=s}}async load(t){var i=new h;this.reset(),await i.et(t),i.nt(),i.ot(),i.ot(),this.Pt=i.st(0),this.$t=new Array(this.Pt),this.fi=new Int32Array(this.Pt),this.e=new Int32Array(this.Pt);for(let t=0;t<this.Pt;t++)i.ot(),this.$t[t]=new u,this.$t[t].Nt=i.st(0),this.$t[t].Dt=i.st(1),this.$t[t].St=i.st(2),this.$t[t].Ct=i.st(3),this.$t[t].Ot=i.st(4),this.$t[t].Ht=i.st(5),this.$t[t].Zt=i.st(6),this.$t[t].qt=i.st(7),this.$t[t].Wt=i.st(8),this.$t[t].Vt=i.st(9),this.$t[t].rotation=i.st(10),this.$t[t].alpha=i.st(11),this.$t[t].Tt=i.st(12);i.ot(),this.ni=i.st(0),this.ri=i.st(1),this.oi=i.st(2),i.ot(),this.mi=i.st(0),this.di=new Array(this.mi);for(let t=0;t<this.mi;t++)i.ot(),this.di[t]=new f,this.di[t].b=i.st(0),this.di[t].a=this.$t[this.di[t].b],this.di[t].c=i.st(1),this.di[t].d=i.st(2),this.di[t].e=i.st(3),this.di[t].f=i.st(4),this.di[t].ui=i.st(5);i.close()}yi(){return this.$t[0]}bi(){return this.ni}reset(){this.$t=void 0,this.fi=void 0,this.e=void 0,this.di=void 0}}var g,m=GIF,p=t.n(m);const w="M 7.97 2.16 L 12.79 2.16 L 12.79 27.84 L 7.97 27.84 Z M 19.21 2.16 L 24.02 2.16 L 24.02 27.84 L 19.21 27.84 Z";new class{Mi;_i;xi;$i;Pi;Ii;Ai;Fi;Li;$;P;ki;loading;zoom;Ti=!1;Ni;Bi;Di;Ri;stopped=!0;Si=0;zi=0;Ci=new Array(2);Ui=new Array(3);Oi=new Array(3);stop=!1;Hi=1e3/30;then=0;loaded=!1;Xi=new l;Yi;constructor(){let t=this;if(i.h.canvas=document.getElementById("canvas"),i.h.l=i.h.canvas.getContext("webgl2"),i.h.l||(console.warn("WebGL2 is not available, fallback to webgl"),i.h.l=i.h.canvas.getContext("webgl"),i.h.l)){var h=i.h.l.createProgram();i.h.l.attachShader(h,e(i.h.l.VERTEX_SHADER,"\nattribute vec2 vertexPosition;\nattribute vec2 texturePosition;\n\nuniform mat4 u_matrix;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n\tgl_Position = u_matrix * vec4(vertexPosition, 0.0, 1.0);\n\tvTexturePosition = texturePosition;\n}")),i.h.l.attachShader(h,e(i.h.l.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D sampler;\nuniform float v_alpha;\nuniform int mode;\nuniform float canvasH;\nuniform vec3 color1;\nuniform vec3 color2;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n\tif (mode == 3) {\n\t\tfloat frac = gl_FragCoord.y / canvasH;\n\t\tif (frac > 0.5)\n\t\t\tfrac = 1.0 - frac;\n\t\tgl_FragColor = vec4(color1 + (color2 * frac), 1.0);\n\t} else {\n\t\tvec4 c = texture2D(sampler, vTexturePosition);\n\t\tc.xyz *= (v_alpha * c.a);\n\t\tif (mode == 1) {\n\t\t\tc.a*=v_alpha;\n\t\t\tc.xyz*=v_alpha;\n\t\t} else {\n\t\t\tc.a*=v_alpha;\n\t\t\tc.xyz=1.0-c.a+c.xyz*c.a;\n\t\t}\n\t\tgl_FragColor = c;\n\t}\n}")),i.h.l.linkProgram(h),i.h.l.useProgram(h),i.h.o=h,i.h.position=i.h.l.getAttribLocation(h,"vertexPosition"),i.h.m=i.h.l.getAttribLocation(h,"texturePosition"),i.h.v=i.h.l.getUniformLocation(h,"mode"),i.h.M=i.h.l.getUniformLocation(h,"u_matrix"),i.h.u=i.h.l.createBuffer(),i.h.p=i.h.l.createBuffer(),i.h.g=i.h.l.getUniformLocation(h,"v_alpha"),i.h.I=i.h.l.getUniformLocation(h,"canvasH"),i.h.$=i.h.l.getUniformLocation(h,"color1"),i.h.P=i.h.l.getUniformLocation(h,"color2"),s.h.J(),this.zoom=document.getElementById("zoom");{const t=window.devicePixelRatio||1;this.zoom.value=(~~Math.min(100,Math.max(50,Math.min(i.h.canvas.clientWidth*t,i.h.canvas.clientHeight*t)/5))).toString()}o(),s.h.tt(),window.onresize=o,this.zoom.onchange=o,this.$i=document.getElementById("animtype"),this.Mi=document.getElementById("next"),this._i=document.getElementById("prev"),this.xi=document.getElementById("pause"),this.Pi=document.getElementById("unitid"),this.Ii=document.getElementById("range"),this.Ai=document.getElementById("downloadImg"),this.Fi=document.getElementById("downloadV"),this.Li=document.getElementById("icons"),this.ki=document.getElementById("nframe"),this.loading=document.getElementById("loading");for(let t=0;t<3;++t)this.Ci[t]=new n;for(let t=0;t<3;++t)this.Oi[t]=new d;for(let t=0;t<3;++t){const i=this.Ui[t]=new Array(4);for(let t=0;t<4;++t)i[t]=new r}this.Pi.onchange=this.qi.bind(this);{const t=new URL(location.href).searchParams.get("id");if(t){const i=parseInt(t);isFinite(i)&&i&&(this.Pi.value=i.toString()),console.log("[AnimPage::install] set unitid value to ",this.Pi.value)}}this.xi.onclick=function(){t.stopped?(t.xi.firstElementChild.firstElementChild.setAttribute("d",w),t.stop=!1,t.stopped=!1,t.animate()):(t.xi.firstElementChild.firstElementChild.setAttribute("d","M 4.76 2.16 L 27.23 15 L 4.76 27.84 Z"),t.Di=NaN,t.stop=!0)},this.Mi.onclick=function(){t.stopped&&(t.Ii.value=(++t.Ri).toString(),t.Zi())},this._i.onclick=function(){t.stopped&&(t.Ri=Math.max(t.Ri-1,0),t.Ii.value=t.Ri.toString(),t.Zi())},this.Ii.oninput=function(){t.stopped&&(t.Ri=parseInt(t.Ii.value),t.Zi())},this.$i.oninput=function(){t.Ri=0,t.Zi(),t.Si=t.$i?.selectedIndex,t.Ii.max=t.Ui[t.zi][t.Si].It.toString()},this.Ai.onclick=function(){var e=s.h,h=(e.Z(),t.Zi(),e.q(),new OffscreenCanvas(Math.max(e.C-e.S,100),Math.max(e.U-e.O,100))),n=(t.Gi(h),h.getContext("2d"));e.H=e.S,e.X=e.O,t.Zi(!0),n.drawImage(i.h.l.canvas,0,0),h.convertToBlob({type:"image/png",quality:1}).then(function(i){var s=document.createElement("a"),i=window.URL.createObjectURL(i);s.href=i,s.download=`Cat No.${t.Di}.png`,s.click()}),e.H=e.X=0,o()},this.Fi.onclick=function(){t.stop=!0,t.Ri=0;var e=i.h.l;if(h=prompt("每禎延遲(毫秒)\n延遲 = 1000 / 禎率 = 1000 / 30 = 33.33...","33")){var h=parseInt(h);if(isFinite(h)&&!(h<=0))if(n=prompt("開始禎","0")){var n=parseInt(n),a=t.Ui[t.zi][t.Si].It;if(!(!isFinite(n)||n<0||a<n)){var r=prompt("結束禎",a.toString());if(r&&(r=parseInt(r),isFinite(r))&&!(r<n)){a=prompt("精度(像素採樣間隔，越低品質越好，最低1)","10");if(a&&(a=parseInt(a),isFinite(a))&&!(a<=0)){var l=s.h;l.Z();for(let i=n;i<=r;++i)t.Zi(!0),t.Ri=i;l.q();var u=new OffscreenCanvas(Math.max(l.C-l.S,100),Math.max(l.U-l.O,100)),f=(t.Gi(u),u.getContext("2d",{Ei:!0})),d=(l.H=l.S,l.X=l.O,new(p())({quality:a,width:u.width,height:u.height}));for(let i=n;i<=r;++i)t.Zi(!0),t.Ri=i,f.drawImage(e.canvas,0,0),d.frames.push({data:f.getImageData(0,0,u.width,u.height).data,delay:h,Wi:!1,ji:-1});l.H=l.X=0;let m=t.Ii?.max;t.Ii.value="0",d.on("progress",function(i){t.Ii.value=(~~(1e3*i)).toString()}),d.on("finished",function(i){var s=document.createElement("a"),i=window.URL.createObjectURL(i);s.href=i,s.download="animation.gif",s.click(),t.Ii.value=m}),d.render(),o()}}}}}},document.getElementById("fps").oninput=function(i){i=i.currentTarget;t.Hi=1e3/parseInt(i.value)},t.$=document.getElementById("color1"),t.P=document.getElementById("color2"),t.$.oninput=t.P.oninput=function(s){var e=t.$.value,h=t.P.value,e=[parseInt(e.substring(1,3),16),parseInt(e.substring(3,5),16),parseInt(e.substring(5,7),16)],h=[parseInt(h.substring(1,3),16)-e[0],parseInt(h.substring(3,5),16)-e[1],parseInt(h.substring(5,7),16)-e[2]],a=i.h.l;a.uniform3f(i.h.$,e[0]/255,e[1]/255,e[2]/255),a.uniform3f(i.h.P,h[0]/255,h[1]/255,h[2]/255),t.stopped&&t.Zi()},this.Yi=this.animate.bind(this),this.qi({currentTarget:this.Pi}),document.getElementById("settings").onclick=document.getElementById("share").onclick=function(t){t.stopPropagation(),!g||t.target instanceof HTMLInputElement?(g=t.currentTarget.firstElementChild.nextElementSibling).style.display="block":(g.style.display="none",g=null)},document.getElementById("nextu").onclick=async function(){t.stopped;var i=parseInt(t.Pi.value),s=(i+=1,t.Pi.value=i.toString(),t.Di=NaN,t.stop=!0,new URL(location.href));s.searchParams.set("id",i.toString()),history.pushState({},"",s),await t.Vi(i),t.Di=i,t.Ri=0,t.stopped&&(t.stopped=!1,t.stop=!1,t.xi.firstElementChild.firstElementChild.setAttribute("d",w),t.animate())},document.getElementById("prevu").onclick=async function(){t.stopped;var i=parseInt(t.Pi.value),s=(--i,t.Pi.value=i.toString(),t.Di=NaN,t.stop=!0,new URL(location.href));s.searchParams.set("id",i.toString()),history.pushState({},"",s),await t.Vi(i),t.Di=i,t.Ri=0,t.stopped&&(t.stopped=!1,t.stop=!1,t.xi.firstElementChild.firstElementChild.setAttribute("d",w),t.animate())},window.onkeydown=function(i){switch(i.keyCode){case 80:case 32:t.xi.onclick();break;case 68:case 39:a(4,0);break;case 65:case 37:a(-4,0);break;case 87:case 38:a(0,-4);break;case 83:case 40:a(0,4);break;case 78:t.Mi.onclick();break;case 66:t._i.onclick()}};for(let i of this.Li.children)i.onclick=function(i){var s=i.currentTarget;t.zi=parseInt(s.getAttribute("data-i"));for(let i of t.Li?.children)i.className=i==s?"active":"";t.Ii.max=t.Ui[t.zi][t.Si].It.toString(),t.Ii.value="0",t.Ri=0,t.stopped&&t.Zi()};i.h.canvas.addEventListener("mousedown",function(i){t.Ti=!0}),i.h.canvas.addEventListener("mouseup",function(i){t.Ti=!1}),i.h.canvas.addEventListener("mousemove",function(e){e.preventDefault(),e.stopPropagation(),t.Ti&&(i.h.A+=e.movementX,i.h.F+=e.movementY,t.stopped)&&(s.h.tt(),t.Oi[t.zi].gi(i.h.A-t.Xi.x,i.h.F-t.Xi.y))}),i.h.canvas.addEventListener("touchstart",function(i){t.Ni=i.touches[0].clientX,t.Bi=i.touches[0].clientY,i.preventDefault()}),i.h.canvas.addEventListener("touchmove",function(e){e.preventDefault();var{clientX:e,clientY:n}=e.changedTouches[0];i.h.A+=e-t.Ni,i.h.F+=n-t.Bi,t.Ni=e,t.Bi=n,t.stopped&&(s.h.tt(),t.Oi[t.zi].gi(i.h.A-t.Xi.x,i.h.F-t.Xi.y))}),addEventListener("click",function(){g&&(g.style.display="none",g=null)}),i.h.l.clearColor(1,1,1,1),console.log("[AnimPage::install] complete")}else alert("您的瀏覽器不支援 WebGL");function e(t,s){t=i.h.l.createShader(t);if(i.h.l.shaderSource(t,s),i.h.l.compileShader(t),i.h.l.getShaderParameter(t,i.h.l.COMPILE_STATUS))return t;throw alert(i.h.l.getShaderInfoLog(t)),""}function o(){var n,c,l,h,o,e=parseInt(t.zoom.value);isNaN(e)||e<=0||(h=i.h.canvas,n=window.devicePixelRatio||1,o=~~(h.clientWidth*n),n=~~(h.clientHeight*n),e=100/e,c=i.h.l,l=(h.width=o)*e,h=(h.height=n)*e,i.h.A=l/2,i.h.F=2*h/3,c.uniform1f(i.h.I,n),c.viewport(0,0,o,n),i.h.T(0,l,h,0,-1,1),c.uniformMatrix4fv(i.h.M,!1,i.h._),i.h.L=e,(o=s.h.Y)[3]=h,o[4]=l,o[6]=l,o[7]=h,t.stopped&&t.Zi())}function a(s,e){i.h.A+=s,i.h.F+=e,t.stopped&&t.Zi()}}Zi(t=!1){var e,h;this.loaded&&(e=this.Oi[this.zi],h=this.Ui[this.zi][this.Si],this.Ri>h.It&&(this.Ri=0),this.ki.textContent=this.Ri.toString(),e.hi(h,this.Ri),(h=e.pi(0)).a.ci(e,h.d,h.e,this.Xi),t?i.h.l.clear(i.h.l.COLOR_BUFFER_BIT):s.h.tt(),e.gi(i.h.A-this.Xi.x,i.h.F-this.Xi.y),console.log("[AnimPage::install] drawFrame"))}Gi(t){var s=i.h.canvas;s.width=t.width,s.height=t.height,i.h.l.viewport(0,0,s.width,s.height),window.devicePixelRatio,i.h.T(0,s.width,s.height,0,-1,1),i.h.l.uniformMatrix4fv(i.h.M,!1,i.h._),i.h.L=1}async qi(t){console.log("AnimPage::handleInput"),console.log(t.currentTarget.value);var s,t=parseInt(t.currentTarget.value);console.log(t,isFinite(t)),isFinite(t)&&(this.Di=NaN,this.stop=!0,(s=new URL(location.href)).searchParams.set("id",t.toString()),history.pushState({},"",s),console.log("loading resources"),await this.Vi(t),console.log("loadResources complete, stopped: ",this.stopped),this.Di=t,this.Ri=0,this.stopped)&&(this.stopped=!1,this.stop=!1,this.xi.firstElementChild.firstElementChild.setAttribute("d",w),console.log("start animate!"),this.animate())}animate(t){if(null!=t&&(this.Ii.value=this.Ri.toString()),this.stop)if(isNaN(this.Di)){this.stopped=!0;let t=parseInt(this.Pi.value);if(!isFinite(t))return;this.Di=t}else this.stop=!1,this.Ri=0,this.stopped=!1,this.animate();else{requestAnimationFrame(this.Yi);var t=performance.now(),s=t-this.then;s>this.Hi&&(this.then=t-s%this.Hi,this.Zi(),++this.Ri)}}async Vi(t){this.zi=0,this.loaded=!1,this.loading.style.display="block",console.log("loadResources ",t);try{if(t<0){-0==(t=-(t+1))&&(t=0);let s=i.k(t);for(let t of this.Ci)t.reset();let e=new Array;e.push(this.Ci[0].load(`https://battlecatsinfo.github.io/img/e/${s}/${s}_e.png`,`/data/enemy/${s}/${s}_e.imgcut`,0));for(let t=0;t<4;++t)e.push(this.Ui[0][t].load(`/data/enemy/${s}/${s}_e0${t}.maanim`));const h=this.Oi[0],n=(h.wi(this.Ci[0]),e.push(h.load(`/data/enemy/${s}/${s}_e.mamodel`)),await Promise.all(e),this.Ii.max=this.Ui[0][this.Si].It.toString(),this.Li?.children);n[0].style.display="none",n[1].style.display="none",n[2].style.display="none",this.loading.style.display="none",this.loaded=!0,void console.log("[AnimPage::install] load enemy complete")}else{var s=i.k(t);console.log("reset textures");for(let t of this.Ci)t.reset();var e=unit_counts[t],h=new Array,n=eggs[t]||[];for(let t=0;t<n.length;++t)n[t]=i.k(n[t]);console.log("load textures");for(let t=0;t<e;++t)if(null!=n[t])h.push(this.Ci[t].load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.png`,`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.imgcut`,0));else{const i="fcs"[t];h.push(this.Ci[t].load(`https://battlecatsinfo.github.io/img/u/${s}/${i}/${s}_${i}.png`,`/data/unit/${s}/${i}/${s}_${i}.imgcut`,0))}console.log("load maanims");for(let t=0;t<e;++t)if(null!=n[t])for(let i=0;i<4;++i)h.push(this.Ui[t][i].load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m0${i}.maanim`));else{const i="fcs"[t];for(let e=0;e<4;++e)h.push(this.Ui[t][e].load(`/data/unit/${s}/${i}/${s}_${i}0${e}.maanim`))}console.log("load mamodles");for(let t=0;t<e;++t){const i=this.Oi[t];if(null!=n[t])i.wi(this.Ci[t]),h.push(i.load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.mamodel`));else{const e="fcs"[t];i.wi(this.Ci[t]),h.push(i.load(`/data/unit/${s}/${e}/${s}_${e}.mamodel`))}}console.log("Promise.all"),await Promise.all(h);var o=this.Li?.children;console.log("create icons");for(let t=0;t<3;++t){const i=o[t];if(t>=e)i.style.display="none";else if(i.style.display="block",null!=n[t])i.src=`https://battlecatsinfo.github.io/img/s/${n[t]}/uni${n[t]}_m00.png`;else{const e="fcs"[t];i.src=`https://battlecatsinfo.github.io/img/u/${s}/${e}/uni${s}_${e}00.png`}i.className=t?"":"active"}console.log("create icons complete"),this.Ii.max=this.Ui[0][this.Si].It.toString(),this.loading.style.display="none",this.loaded=!0,console.log("[AnimPage::install] load units complete")}}catch(t){console.error(t),alert("載入資源失敗，請檢查您的網路狀態:\n"+t.message)}}}})();