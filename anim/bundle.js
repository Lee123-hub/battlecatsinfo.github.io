(()=>{"use strict";var t={n:i=>{var s=i&&i.t?()=>i.default:()=>i;return t.d(s,{a:s}),s},d:(i,s)=>{for(var h in s)t.i(s,h)&&!t.i(i,h)&&Object.defineProperty(i,h,{enumerable:!0,get:s[h]})},i:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};class i{static h=new i;o;canvas;l;position;u;m;p;v;g;M;_=new Float32Array(16);$;I;P;A;F;L;static k(t){var i=t.toString();switch(i.length){case 3:return i;case 2:return"0"+i;default:return"00"+i}}T(t,i,s,h,e,n){this._[0]=2/(i-t),this._[1]=0,this._[2]=0,this._[3]=0,this._[4]=0,this._[5]=2/(h-s),this._[6]=0,this._[7]=0,this._[8]=0,this._[9]=0,this._[10]=2/(e-n),this._[11]=0,this._[12]=(t+i)/(t-i),this._[13]=(s+h)/(s-h),this._[14]=(e+n)/(e-n),this._[15]=1}scale(t,i){this._[0]*=t,this._[1]*=t,this._[2]*=t,this._[3]*=t,this._[4]*=i,this._[5]*=i,this._[6]*=i,this._[7]*=i}translate(t,i){this._[12]=this._[0]*t+this._[4]*i+this._[8]+this._[12],this._[13]=this._[1]*t+this._[5]*i+this._[9]+this._[13],this._[14]=this._[2]*t+this._[6]*i+this._[10]+this._[14],this._[15]=this._[3]*t+this._[7]*i+this._[11]+this._[15]}}class s{static h=new s;N=new Float32Array(8);B;D;S=!1;C;R;U;O;H=0;X=0;Y=new Float32Array(8);Z(){this.C=i.h.canvas.width,this.R=0,this.O=i.h.canvas.height,this.U=0,this.S=!0}q(){this.S=!1,this.C=this.C-10,this.R=this.R+10,this.O=this.O-10,this.U=this.U+10}G(t){var s=i.h.l;switch(t){case 0:s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.uniform1i(i.h.g,1);break;case 1:s.blendFunc(s.ONE,s.ONE),s.uniform1i(i.h.g,1);break;case 2:s.blendFunc(s.ZERO,s.SRC_COLOR),s.uniform1i(i.h.g,1);break;case 3:s.blendFunc(s.ONE_MINUS_DST_COLOR,s.ONE),s.uniform1i(i.h.g,2)}}W(t,s,h,e,n,o,a,r,c,l,u,f,d){if(this.S)this.C=Math.min(s,e,o,r,this.C),this.R=Math.max(s,e,o,r,this.R),this.O=Math.min(h,n,a,c,this.O),this.U=Math.max(h,n,a,c,this.U);else{var m=i.h.l;this.N[0]=s-this.H,this.N[1]=h-this.X,this.N[2]=e-this.H,this.N[3]=n-this.X,this.N[4]=r-this.H,this.N[5]=c-this.X,this.N[6]=o-this.H,this.N[7]=a-this.X,m.bindBuffer(m.ARRAY_BUFFER,i.h.u),m.bufferData(m.ARRAY_BUFFER,this.N,m.STATIC_DRAW),this.N[0]=l,this.N[1]=u,this.N[2]=l,this.N[3]=u+d,this.N[4]=l+f,this.N[5]=u,this.N[6]=l+f,this.N[7]=u+d;for(let i=0;i<8;)this.N[i++]/=t.j,this.N[i++]/=t.V;m.bindBuffer(m.ARRAY_BUFFER,i.h.p),m.bufferData(m.ARRAY_BUFFER,this.N,m.STATIC_DRAW),m.bindTexture(m.TEXTURE_2D,t.K),m.drawArrays(m.TRIANGLE_STRIP,0,4)}}J(){var t=i.h.l;t.bindBuffer(t.ARRAY_BUFFER,i.h.u),t.vertexAttribPointer(i.h.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i.h.position),t.bindBuffer(t.ARRAY_BUFFER,i.h.p),t.vertexAttribPointer(i.h.m,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(i.h.m),t.bindBuffer(t.ARRAY_BUFFER,i.h.p),t.bufferData(t.ARRAY_BUFFER,this.N,t.STATIC_DRAW),t.enable(t.BLEND),t.uniform3f(i.h.$,70/255,140/255,160/255),t.uniform3f(i.h.I,45/255,90/255,90/255)}setAlpha(t){i.h.l.uniform1f(i.h.v,t)}tt(){var t=i.h.l;t.blendFunc(t.ONE,t.ZERO),t.bindBuffer(t.ARRAY_BUFFER,i.h.u),t.bufferData(t.ARRAY_BUFFER,this.Y,t.STATIC_DRAW),t.uniform1i(i.h.g,3),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}class h{x;y;width;height}class e{a;b;it=0;st(t){return parseInt(this.b[t])}async ht(t){t=await fetch(t);if(!t.ok)throw"File not found";this.a=await t.text()}et(t){return this.b[t]}nt(){var t;return this.it>=this.a.length?null:(t=this.it,this.it=this.a.indexOf("\n",t),-1==this.it?(this.it=this.a.length,this.a.slice(t)):(t=this.a.slice(t,this.it++)).includes("\r")?t.replaceAll("\r",""):t)}ot(t=","){var i=this.nt();return i&&(this.b=i.split(t)),this.b}c(){return this.a}close(){}}class n{K;j;V;name;rt;async load(t,s,n=0){if(this.reset(),null!=s)if(0!=(1&n)){let t=new e,i=(await t.ht(s),t.nt(),t.nt(),t.nt(),t.ot(),t.st(0));this.rt=new Array(i);for(let s=0;s<i;s++)t.ot(),this.rt[s].x=t.st(0),this.rt[s].y=t.st(1),this.rt[s].width=t.st(2),this.rt[s].height=t.st(3);t.close()}else{let t=new e,i=(await t.ht(s),t.nt(),t.nt(),t.nt(),t.ot(),t.st(0));this.rt=new Array(i);for(let s=0;s<i;s++)t.ot(),this.rt[s]=new h,this.rt[s].x=t.st(0),this.rt[s].y=t.st(1),this.rt[s].width=t.st(2),this.rt[s].height=t.st(3);t.close()}const o=i.h.l,a=document.createElement("img");a.crossOrigin="anonymous",a.src=t,await new Promise(function(t,i){a.onload=t,a.onerror=i}),this.j=a.naturalWidth,this.V=a.naturalHeight,this.K=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.K),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a)}reset(){this.K&&(i.h.l.deleteTexture(this.K),this.K=null)}}class o{frame;ct;lt;ut}class a{ft;dt;loop;wt;vt;gt=0;max=0;yt=0;bt=0;Mt(){if(this.wt&&(this.vt[0].frame<0||-1!=this.loop)){this.gt=-this.vt[0].frame;for(let t=0;t<this.wt;++t)this.vt[t].frame+=this.gt}return this.wt&&(this.yt=this.vt[0].frame,this.max=this.vt[this.wt-1].frame),-1!=this.loop?1<this.loop?this.yt+(this.max-this.yt)*this.loop:this.max-this.gt:this.max-Math.min(this.gt,0)}_t(t){this.wt&&t[this.ft].$t(this.dt,this.vt[this.wt-1].ct)}}class r{xt;It;Pt;async load(t){var i=new e;this.Pt=0,await i.ht(t),i.nt(),i.nt(),i.ot(),this.It=i.st(0),this.xt=new Array(this.It);for(let t=0;t<this.It;t++){i.ot();var s=new a;(this.xt[t]=s).ft=i.st(0),s.dt=i.st(1),s.loop=i.st(2),i.ot(),s.wt=i.st(0),s.vt=new Array(s.wt);for(let t=0;t<s.wt;t++)i.ot(),s.vt[t]=new o,s.vt[t].frame=i.st(0),s.vt[t].ct=i.st(1),s.vt[t].lt=i.st(2),s.vt[t].ut=i.st(3);var h=s.Mt();h>this.Pt&&(this.Pt=h)}i.close()}}class c{_=new Float32Array(6);constructor(){this.At()}At(){this._[0]=1,this._[1]=0,this._[2]=0,this._[3]=0,this._[4]=1,this._[5]=0}rotate(t){var i=Math.cos(t*Math.PI/180),s=(t=Math.sin(t*Math.PI/180),this._[0]);this._[0]=this._[0]*i+this._[1]*t,this._[1]=s*-t+this._[1]*i,s=this._[3],this._[3]=this._[3]*i+this._[4]*t,this._[4]=i*this._[4]+(t=-t)*s}setTranslate(t,i){this._[0]=1,this._[1]=0,this._[2]=t,this._[3]=0,this._[4]=1,this._[5]=i}setRotate(t){this._[0]=Math.cos(t*Math.PI/180),this._[1]=-Math.sin(t*Math.PI/180),this._[2]=0,this._[3]=Math.sin(t*Math.PI/180),this._[4]=Math.cos(t*Math.PI/180),this._[5]=0}setScale(t,i){this._[0]=t/100,this._[1]=0,this._[2]=0,this._[3]=0,this._[4]=i/100,this._[5]=0}scale(t,i){this._[0]=this._[0]*t/100,this._[1]=this._[1]*i/100,this._[3]=this._[3]*t/100,this._[4]=this._[4]*i/100}set(t){this._.set(t._)}transform(t,i,s){s.x=~~(this._[0]*t+this._[1]*i+this._[2]),s.y=~~(this._[3]*t+this._[4]*i+this._[5])}translate(t,i){this._[2]=this._[2]+this._[0]*t+this._[1]*i,this._[5]=this._[5]+this._[3]*t+this._[4]*i}mul(t){var i=this._[0],s=t._[0],h=this._[1],e=t._[3],n=this._[2],o=t._[1],a=this._[3],r=t._[4],c=this._[4],l=(t._[2],this._[5]),t=t._[5];this._[0]=i*s+h*e,this._[1]=i*o+h*r,this._[2]=n*s+a*e,this._[3]=n*o+a*r,this._[4]=c*s+l*e,this._[5]=c*o+l*r+t}}class l{x=0;y=0}class u{Ft;Lt;kt;Tt;Nt;Bt;Dt;St;zt;Ct;Rt;Ut;Ot;Ht;Xt;Yt;Zt;qt;Gt;Et;Wt;s;jt;Vt;Kt;Jt;rotation;Qt;alpha;ti;ii;E=new Int32Array(8);si=new l;hi=new c;reset(t,i){this.ti=1,this.ii=1,this.Bt=0,this.St=0,this.Ct=0,this.Yt=0,this.Xt=0,this.Gt=0,this.Et=0,this.Ut=0,this.Jt=t,this.jt=t,this.Qt=0,this.kt=i}ei(t){let i,s,h;-1<this.Nt+this.Bt?(h=t.xt[this.Nt+this.Bt],this.s=i=~~(this.Wt*this.jt*h.s/t.ni/t.ni),this.Kt=s=~~(this.Vt*this.Jt*h.Kt/t.ni/t.ni),this.Ft=this.Lt=this.alpha*this.kt*h.Ft/t.oi/t.oi):(i=this.Wt*this.jt/t.ni,this.s=i,s=this.Vt*this.Jt/t.ni,this.Kt=s,this.Ft=this.Lt=this.alpha*this.kt/t.oi),-1<this.Dt+this.St&&(this.E[0]=this.E[2]=-(this.Zt+this.Gt)*i/t.ni,this.E[4]=this.E[6]=i*t.ai.rt[this.zt+this.Ct].width/t.ni+this.E[0],this.E[1]=this.E[7]=-(this.qt+this.Et)*s/t.ni,this.E[3]=this.E[5]=s*t.ai.rt[this.zt+this.Ct].height/t.ni+this.E[1]),h?(this.hi.set(h.hi),this.hi.translate((this.Ot+this.Xt)*h.s/t.ni,(this.Ht+this.Yt)*h.Kt/t.ni)):this.hi.translate(this.Xt,this.Yt),this.hi.rotate(360*(this.rotation+this.Qt)/t.ri);for(let t=0;t<8;t+=2)this.hi.transform(this.E[t],this.E[t+1],this.si),this.E[t]=this.si.x,this.E[t+1]=this.si.y}ci(t,i,s,h){this.hi.transform((i-this.Zt-this.Gt)*this.s/t.ni,(s-this.qt-this.Et)*this.Kt/t.ni,h)}$t(t,i){switch(t){case 0:return void(this.Bt=i-this.Nt);case 1:return void(this.St=i-this.Dt);case 2:return void(this.Ct=i-this.zt);case 3:return void(this.Ut=i-this.Rt);case 4:return void(this.Xt=i);case 5:return void(this.Yt=i);case 6:return void(this.Gt=i);case 7:return void(this.Et=i);case 8:return this.Jt=i,void(this.jt=i);case 9:return void(this.jt=i);case 10:return void(this.Jt=i);case 11:return void(this.Qt=i);case 12:return void(this.kt=i);case 13:return void(this.ti=i?-1:1);case 14:return void(this.ii=i?-1:1)}}li(t,i,s,h){var e;this.Dt<0||this.zt<0||(i.G(this.Tt),(e=this.Lt/t.oi)&&(i.setAlpha(e),t=(e=t.ai).rt[this.Ct+this.zt],i.W(e,this.E[0]+s,this.E[1]+h,this.E[2]+s,this.E[3]+h,this.E[4]+s,this.E[5]+h,this.E[6]+s,this.E[7]+h,t.x,t.y,t.width,t.height)))}}class f{a;b;c;d;e;f;ui}class d{ai;xt;It;fi;e;ni;ri;oi;di;mi;pi(t){return this.di[t]}wi(t){this.ai=t}vi(t,i){var h=s.h;for(let s=0;s<this.It;s++)this.xt[this.fi[s]].li(this,h,t,i)}gi(t,i,s){let h=i,e=i;for(let s=i-1;0<=s&&3==t[s].lt;s--)h=s;for(let s=i+1;s<t.length&&3==t[e=s].lt;s++);let n=0;for(let i=h;i<=e;i++){let o=4096*t[i].ct;for(let n=h;n<=e;n++)i!=n&&(o*=(s-t[n].frame)/(t[i].frame-t[n].frame));n+=o}return~~(n/4096)}ei(t,i=0){if(!i)for(let t of this.xt)t.reset(this.ni,this.oi);if(t)for(var s of t.xt){const t=s.loop,h=s.max,e=s.yt,n=h-e;let o=-1==t?h?(i+s.gt)%h:0:i+s.gt;if(0<t&&n){if(o>e+t*n){s._t(this.xt);continue}o<=e||(o=o<e+t*n?e+(o-e)%n:h)}for(let t=0;t<s.wt;++t)if(o==s.vt[t].frame)this.xt[s.ft].$t(s.dt,s.bt=s.vt[t].ct);else if(t<s.wt-1&&o>s.vt[t].frame&&o<s.vt[t+1].frame){if(1<s.dt){const i=s.vt[t].frame,h=s.vt[t].ct,e=s.vt[t+1].frame,n=s.vt[t+1].ct;let a=(o-i)/(e-i);if(1==s.vt[t].lt||13==s.dt||14==s.dt)a=0;else if(0!=s.vt[t].lt)if(2==s.vt[t].lt)a=0<=s.vt[t].ut?1-Math.sqrt(1-Math.pow(a,s.vt[t].ut)):Math.sqrt(1-Math.pow(1-a,-s.vt[t].ut));else{if(3==s.vt[t].lt){s.bt=this.gi(s.vt,t,o),this.xt[s.ft].$t(s.dt,s.bt);break}4==s.vt[t].lt&&(a=0<s.vt[t].ut?1-Math.cos(a*Math.PI/2):s.vt[t].ut<0?Math.sin(a*Math.PI/2):(1-Math.cos(a*Math.PI))/2)}2==s.dt?s.bt=n-h<0?Math.ceil((n-h)*a+h):(n-h)*a+h:s.bt=(n-h)*a+h,this.xt[s.ft].$t(s.dt,s.bt=~~s.bt);break}0==s.dt&&this.xt[s.ft].$t(0,s.vt[t].ct)}s.wt&&o>s.max&&s._t(this.xt)}for(let t of this.xt)t.ei(this);for(let t=0;t<this.It;t++)this.fi[t]=t,this.e[t]=this.xt[t].Rt+this.xt[t].Ut;for(let t=1;t<this.It;t++){let i=this.fi[t],s=this.e[t],h=t-1;for(;0<=h&&this.e[h]>s;)this.fi[h+1]=this.fi[h],this.e[h+1]=this.e[h],h--;this.fi[h+1]=i,this.e[h+1]=s}}async load(t){var i=new e;this.reset(),await i.ht(t),i.nt(),i.ot(),i.ot(),this.It=i.st(0),this.xt=new Array(this.It),this.fi=new Int32Array(this.It),this.e=new Int32Array(this.It);for(let t=0;t<this.It;t++)i.ot(),this.xt[t]=new u,this.xt[t].Nt=i.st(0),this.xt[t].Dt=i.st(1),this.xt[t].zt=i.st(2),this.xt[t].Rt=i.st(3),this.xt[t].Ot=i.st(4),this.xt[t].Ht=i.st(5),this.xt[t].Zt=i.st(6),this.xt[t].qt=i.st(7),this.xt[t].Wt=i.st(8),this.xt[t].Vt=i.st(9),this.xt[t].rotation=i.st(10),this.xt[t].alpha=i.st(11),this.xt[t].Tt=i.st(12);i.ot(),this.ni=i.st(0),this.ri=i.st(1),this.oi=i.st(2),i.ot(),this.mi=i.st(0),this.di=new Array(this.mi);for(let t=0;t<this.mi;t++)i.ot(),this.di[t]=new f,this.di[t].b=i.st(0),this.di[t].a=this.xt[this.di[t].b],this.di[t].c=i.st(1),this.di[t].d=i.st(2),this.di[t].e=i.st(3),this.di[t].f=i.st(4),this.di[t].ui=i.st(5);i.close()}yi(){return this.xt[0]}bi(){return this.ni}reset(){this.xt=void 0,this.fi=void 0,this.e=void 0,this.di=void 0}}var v,m=GIF,p=t.n(m);const w="M 7.97 2.16 L 12.79 2.16 L 12.79 27.84 L 7.97 27.84 Z M 19.21 2.16 L 24.02 2.16 L 24.02 27.84 L 19.21 27.84 Z";new class{Mi;_i;$i;xi;Ii;Pi;Ai;Fi;Li;$;I;ki;loading;zoom;Ti=!1;Ni;Bi;Di;Si;stopped=!0;zi=0;Ci=0;Ri=new Array(2);Ui=new Array(3);Oi=new Array(3);stop=!1;Hi=1e3/30;then=0;loaded=!1;Xi=new l;Yi;constructor(){let t=this;if(i.h.canvas=document.getElementById("canvas"),i.h.l=i.h.canvas.getContext("webgl2"),i.h.l||(console.warn("WebGL2 is not available, fallback to webgl"),i.h.l=i.h.canvas.getContext("webgl"),i.h.l)){var e=i.h.l.createProgram();i.h.l.attachShader(e,h(i.h.l.VERTEX_SHADER,"\nattribute vec2 vertexPosition;\nattribute vec2 texturePosition;\n\nuniform mat4 u_matrix;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n\tgl_Position = u_matrix * vec4(vertexPosition, 0.0, 1.0);\n\tvTexturePosition = texturePosition;\n}")),i.h.l.attachShader(e,h(i.h.l.FRAGMENT_SHADER,"\nprecision mediump float;\n\nuniform sampler2D sampler;\nuniform float v_alpha;\nuniform int mode;\nuniform float canvasH;\nuniform vec3 color1;\nuniform vec3 color2;\n\nvarying vec2 vTexturePosition;\n\nvoid main(void) {\n\tif (mode == 3) {\n\t\tfloat frac = gl_FragCoord.y / canvasH;\n\t\tif (frac > 0.5)\n\t\t\tfrac = 1.0 - frac;\n\t\tgl_FragColor = vec4(color1 + (color2 * frac), 1.0);\n\t} else {\n\t\tvec4 c = texture2D(sampler, vTexturePosition);\n\t\tc.xyz *= (v_alpha * c.a);\n\t\tif (mode == 1) {\n\t\t\tc.a*=v_alpha;\n\t\t\tc.xyz*=v_alpha;\n\t\t} else {\n\t\t\tc.a*=v_alpha;\n\t\t\tc.xyz=1.0-c.a+c.xyz*c.a;\n\t\t}\n\t\tgl_FragColor = c;\n\t}\n}")),i.h.l.linkProgram(e),i.h.l.useProgram(e),i.h.o=e,i.h.position=i.h.l.getAttribLocation(e,"vertexPosition"),i.h.m=i.h.l.getAttribLocation(e,"texturePosition"),i.h.g=i.h.l.getUniformLocation(e,"mode"),i.h.M=i.h.l.getUniformLocation(e,"u_matrix"),i.h.u=i.h.l.createBuffer(),i.h.p=i.h.l.createBuffer(),i.h.v=i.h.l.getUniformLocation(e,"v_alpha"),i.h.P=i.h.l.getUniformLocation(e,"canvasH"),i.h.$=i.h.l.getUniformLocation(e,"color1"),i.h.I=i.h.l.getUniformLocation(e,"color2"),s.h.J(),this.zoom=document.getElementById("zoom");{const t=window.devicePixelRatio||1;this.zoom.value=(~~Math.min(100,Math.max(50,Math.min(i.h.canvas.clientWidth*t,i.h.canvas.clientHeight*t)/5))).toString()}o(),s.h.tt(),window.onresize=o,this.zoom.onchange=o,this.xi=document.getElementById("animtype"),this.Mi=document.getElementById("next"),this._i=document.getElementById("prev"),this.$i=document.getElementById("pause"),this.Ii=document.getElementById("unitid"),this.Pi=document.getElementById("range"),this.Ai=document.getElementById("downloadImg"),this.Fi=document.getElementById("downloadV"),this.Li=document.getElementById("icons"),this.ki=document.getElementById("nframe"),this.loading=document.getElementById("loading");for(let t=0;t<3;++t)this.Ri[t]=new n;for(let t=0;t<3;++t)this.Oi[t]=new d;for(let t=0;t<3;++t){const i=this.Ui[t]=new Array(4);for(let t=0;t<4;++t)i[t]=new r}window.foo=this.Ii.onchange=this.qi.bind(this),console.log(this.Ii),console.log(this.Ii.value),console.log(this.Ii.onchange),console.log(this.qi);{const t=new URL(location.href).searchParams.get("id");if(t){const i=parseInt(t);isFinite(i)&&i&&(this.Ii.value=i.toString())}}this.$i.onclick=function(){t.stopped?(t.$i.firstElementChild.firstElementChild.setAttribute("d",w),t.stop=!1,t.stopped=!1,t.animate()):(t.$i.firstElementChild.firstElementChild.setAttribute("d","M 4.76 2.16 L 27.23 15 L 4.76 27.84 Z"),t.Di=NaN,t.stop=!0)},this.Mi.onclick=function(){t.stopped&&(t.Pi.value=(++t.Si).toString(),t.Zi())},this._i.onclick=function(){t.stopped&&(t.Si=Math.max(t.Si-1,0),t.Pi.value=t.Si.toString(),t.Zi())},this.Pi.oninput=function(){t.stopped&&(t.Si=parseInt(t.Pi.value),t.Zi())},this.xi.oninput=function(){t.Si=0,t.Zi(),t.zi=t.xi?.selectedIndex,t.Pi.max=t.Ui[t.Ci][t.zi].Pt.toString()},this.Ai.onclick=function(){var h=s.h,e=(h.Z(),t.Zi(),h.q(),new OffscreenCanvas(Math.max(h.R-h.C,100),Math.max(h.U-h.O,100))),n=(t.Gi(e),e.getContext("2d"));h.H=h.C,h.X=h.O,t.Zi(!0),n.drawImage(i.h.l.canvas,0,0),e.convertToBlob({type:"image/png",quality:1}).then(function(i){var s=document.createElement("a"),i=window.URL.createObjectURL(i);s.href=i,s.download=`Cat No.${t.Di}.png`,s.click()}),h.H=h.X=0,o()},this.Fi.onclick=function(){t.stop=!0,t.Si=0;var h=i.h.l;if(e=prompt("每禎延遲(毫秒)\n延遲 = 1000 / 禎率 = 1000 / 30 = 33.33...","33")){var e=parseInt(e);if(isFinite(e)&&!(e<=0))if(n=prompt("開始禎","0")){var n=parseInt(n),a=t.Ui[t.Ci][t.zi].Pt;if(!(!isFinite(n)||n<0||a<n)){var r=prompt("結束禎",a.toString());if(r&&(r=parseInt(r),isFinite(r))&&!(r<n)){a=prompt("精度(像素採樣間隔，越低品質越好，最低1)","10");if(a&&(a=parseInt(a),isFinite(a))&&!(a<=0)){var l=s.h;l.Z();for(let i=n;i<=r;++i)t.Zi(!0),t.Si=i;l.q();var u=new OffscreenCanvas(Math.max(l.R-l.C,100),Math.max(l.U-l.O,100)),f=(t.Gi(u),u.getContext("2d",{Ei:!0})),d=(l.H=l.C,l.X=l.O,new(p())({quality:a,width:u.width,height:u.height}));for(let i=n;i<=r;++i)t.Zi(!0),t.Si=i,f.drawImage(h.canvas,0,0),d.frames.push({data:f.getImageData(0,0,u.width,u.height).data,delay:e,Wi:!1,ji:-1});l.H=l.X=0;let m=t.Pi?.max;t.Pi.value="0",d.on("progress",function(i){t.Pi.value=(~~(1e3*i)).toString()}),d.on("finished",function(i){var s=document.createElement("a"),i=window.URL.createObjectURL(i);s.href=i,s.download="animation.gif",s.click(),t.Pi.value=m}),d.render(),o()}}}}}},document.getElementById("fps").oninput=function(i){i=i.currentTarget;t.Hi=1e3/parseInt(i.value)},t.$=document.getElementById("color1"),t.I=document.getElementById("color2"),t.$.oninput=t.I.oninput=function(s){var h=t.$.value,e=t.I.value,h=[parseInt(h.substring(1,3),16),parseInt(h.substring(3,5),16),parseInt(h.substring(5,7),16)],e=[parseInt(e.substring(1,3),16)-h[0],parseInt(e.substring(3,5),16)-h[1],parseInt(e.substring(5,7),16)-h[2]],a=i.h.l;a.uniform3f(i.h.$,h[0]/255,h[1]/255,h[2]/255),a.uniform3f(i.h.I,e[0]/255,e[1]/255,e[2]/255),t.stopped&&t.Zi()},this.Yi=this.animate.bind(this),document.getElementById("settings").onclick=document.getElementById("share").onclick=function(t){t.stopPropagation(),!v||t.target instanceof HTMLInputElement?(v=t.currentTarget.firstElementChild.nextElementSibling).style.display="block":(v.style.display="none",v=null)},document.getElementById("nextu").onclick=async function(){t.stopped;var i=parseInt(t.Ii.value),s=(i+=1,t.Ii.value=i.toString(),t.Di=NaN,t.stop=!0,new URL(location.href));s.searchParams.set("id",i.toString()),history.pushState({},"",s),await t.Vi(i),t.Di=i,t.Si=0,t.stopped&&(t.stopped=!1,t.stop=!1,t.$i.firstElementChild.firstElementChild.setAttribute("d",w),t.animate())},document.getElementById("prevu").onclick=async function(){t.stopped;var i=parseInt(t.Ii.value),s=(--i,t.Ii.value=i.toString(),t.Di=NaN,t.stop=!0,new URL(location.href));s.searchParams.set("id",i.toString()),history.pushState({},"",s),await t.Vi(i),t.Di=i,t.Si=0,t.stopped&&(t.stopped=!1,t.stop=!1,t.$i.firstElementChild.firstElementChild.setAttribute("d",w),t.animate())},window.onkeydown=function(i){switch(i.keyCode){case 80:case 32:t.$i.onclick();break;case 68:case 39:a(4,0);break;case 65:case 37:a(-4,0);break;case 87:case 38:a(0,-4);break;case 83:case 40:a(0,4);break;case 78:t.Mi.onclick();break;case 66:t._i.onclick()}};for(let i of this.Li.children)i.onclick=function(i){var s=i.currentTarget;t.Ci=parseInt(s.getAttribute("data-i"));for(let i of t.Li?.children)i.className=i==s?"active":"";t.Pi.max=t.Ui[t.Ci][t.zi].Pt.toString(),t.Pi.value="0",t.Si=0,t.stopped&&t.Zi()};i.h.canvas.addEventListener("mousedown",function(i){t.Ti=!0}),i.h.canvas.addEventListener("mouseup",function(i){t.Ti=!1}),i.h.canvas.addEventListener("mousemove",function(h){h.preventDefault(),h.stopPropagation(),t.Ti&&(i.h.A+=h.movementX,i.h.F+=h.movementY,t.stopped)&&(s.h.tt(),t.Oi[t.Ci].vi(i.h.A-t.Xi.x,i.h.F-t.Xi.y))}),i.h.canvas.addEventListener("touchstart",function(i){t.Ni=i.touches[0].clientX,t.Bi=i.touches[0].clientY,i.preventDefault()}),i.h.canvas.addEventListener("touchmove",function(h){h.preventDefault();var{clientX:h,clientY:n}=h.changedTouches[0];i.h.A+=h-t.Ni,i.h.F+=n-t.Bi,t.Ni=h,t.Bi=n,t.stopped&&(s.h.tt(),t.Oi[t.Ci].vi(i.h.A-t.Xi.x,i.h.F-t.Xi.y))}),addEventListener("click",function(){v&&(v.style.display="none",v=null)}),i.h.l.clearColor(1,1,1,1),console.log("begin handleInput"),this.qi(),console.log("end handleInput")}else alert("您的瀏覽器不支援 WebGL");function h(t,s){t=i.h.l.createShader(t);if(i.h.l.shaderSource(t,s),i.h.l.compileShader(t),i.h.l.getShaderParameter(t,i.h.l.COMPILE_STATUS))return t;throw alert(i.h.l.getShaderInfoLog(t)),""}function o(){var n,c,l,e,o,h=parseInt(t.zoom.value);isNaN(h)||h<=0||(e=i.h.canvas,n=window.devicePixelRatio||1,o=~~(e.clientWidth*n),n=~~(e.clientHeight*n),h=100/h,c=i.h.l,l=(e.width=o)*h,e=(e.height=n)*h,i.h.A=l/2,i.h.F=2*e/3,c.uniform1f(i.h.P,n),c.viewport(0,0,o,n),i.h.T(0,l,e,0,-1,1),c.uniformMatrix4fv(i.h.M,!1,i.h._),i.h.L=h,(o=s.h.Y)[3]=e,o[4]=l,o[6]=l,o[7]=e,t.stopped&&t.Zi())}function a(s,h){i.h.A+=s,i.h.F+=h,t.stopped&&t.Zi()}}Zi(t=!1){var h,e;this.loaded&&(h=this.Oi[this.Ci],e=this.Ui[this.Ci][this.zi],this.Si>e.Pt&&(this.Si=0),this.ki.textContent=this.Si.toString(),h.ei(e,this.Si),(e=h.pi(0)).a.ci(h,e.d,e.e,this.Xi),t?i.h.l.clear(i.h.l.COLOR_BUFFER_BIT):s.h.tt(),h.vi(i.h.A-this.Xi.x,i.h.F-this.Xi.y))}Gi(t){var s=i.h.canvas;s.width=t.width,s.height=t.height,i.h.l.viewport(0,0,s.width,s.height),window.devicePixelRatio,i.h.T(0,s.width,s.height,0,-1,1),i.h.l.uniformMatrix4fv(i.h.M,!1,i.h._),i.h.L=1}async qi(){var i,t=parseInt(this.Ii.value);console.log("switch to "+t.toString()),isFinite(t)&&(this.Di=NaN,this.stop=!0,(i=new URL(location.href)).searchParams.set("id",t.toString()),history.pushState({},"",i),await this.Vi(t),this.Di=t,this.Si=0,this.stopped)&&(this.stopped=!1,this.stop=!1,this.$i.firstElementChild.firstElementChild.setAttribute("d",w),this.animate())}animate(t){if(null!=t&&(this.Pi.value=this.Si.toString()),this.stop)if(isNaN(this.Di)){this.stopped=!0;let t=parseInt(this.Ii.value);if(!isFinite(t))return;this.Di=t}else this.stop=!1,this.Si=0,this.stopped=!1,this.animate();else{requestAnimationFrame(this.Yi);var t=performance.now(),s=t-this.then;s>this.Hi&&(this.then=t-s%this.Hi,this.Zi(),++this.Si)}}async Vi(t){console.log("loading resources for "+t.toString()),this.Ci=0,this.loaded=!1,this.loading.style.display="block";try{if(t<0){-0==(t=-(t+1))&&(t=0);let s=i.k(t);for(let t of this.Ri)t.reset();let h=new Array;h.push(this.Ri[0].load(`https://battlecatsinfo.github.io/img/e/${s}/${s}_e.png`,`/data/enemy/${s}/${s}_e.imgcut`,0));for(let t=0;t<4;++t)h.push(this.Ui[0][t].load(`/data/enemy/${s}/${s}_e0${t}.maanim`));const e=this.Oi[0],n=(e.wi(this.Ri[0]),h.push(e.load(`/data/enemy/${s}/${s}_e.mamodel`)),await Promise.all(h),this.Pi.max=this.Ui[0][this.zi].Pt.toString(),this.Li?.children);n[0].style.display="none",n[1].style.display="none",n[2].style.display="none",this.loading.style.display="none",void(this.loaded=!0)}else{var s=i.k(t);for(let t of this.Ri)t.reset();var h=unit_counts[t],e=new Array,n=eggs[t]||[];for(let t=0;t<n.length;++t)n[t]=i.k(n[t]);for(let t=0;t<h;++t)if(null!=n[t])e.push(this.Ri[t].load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.png`,`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.imgcut`,0));else{const i="fcs"[t];e.push(this.Ri[t].load(`https://battlecatsinfo.github.io/img/u/${s}/${i}/${s}_${i}.png`,`/data/unit/${s}/${i}/${s}_${i}.imgcut`,0))}for(let t=0;t<h;++t)if(null!=n[t])for(let i=0;i<4;++i)e.push(this.Ui[t][i].load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m0${i}.maanim`));else{const i="fcs"[t];for(let h=0;h<4;++h)e.push(this.Ui[t][h].load(`/data/unit/${s}/${i}/${s}_${i}0${h}.maanim`))}for(let t=0;t<h;++t){const i=this.Oi[t];if(null!=n[t])i.wi(this.Ri[t]),e.push(i.load(`https://battlecatsinfo.github.io/img/s/${n[t]}/${n[t]}_m.mamodel`));else{const h="fcs"[t];i.wi(this.Ri[t]),e.push(i.load(`/data/unit/${s}/${h}/${s}_${h}.mamodel`))}}await Promise.all(e);var o=this.Li?.children;for(let t=0;t<3;++t){const i=o[t];if(t>=h)i.style.display="none";else if(i.style.display="block",null!=n[t])i.src=`https://battlecatsinfo.github.io/img/s/${n[t]}/uni${n[t]}_m00.png`;else{const h="fcs"[t];i.src=`https://battlecatsinfo.github.io/img/u/${s}/${h}/uni${s}_${h}00.png`}i.className=t?"":"active"}this.Pi.max=this.Ui[0][this.zi].Pt.toString(),this.loading.style.display="none",this.loaded=!0}}catch(t){console.error(t),alert("載入資源失敗，請檢查您的網路狀態:\n"+t.message)}}}})();