<!DOCTYPE html><html lang=zh-Hant><head><meta charset=utf-8><title>關卡字型</title><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=stylesheet type=text/css href=/dracula.css><link rel=stylesheet type=text/css href=w3.css><style>
html, body {
	margin: 0;
	padding: 0;
	width: 100%;
}

.topnav { background-color: #333 !important;margin-block:0; display: inline-block;width: 100%;text-align:center;font-size: min(2vw, 20px) !important; }
.topnav > a { display: inline-block;color: #f2f2f2 !important; padding: 1vh 2vw; text-decoration: none;cursor: pointer;vertical-align: middle; }
.topnav > a.active { background-color: #4caf50 !important; }
.topnav > a:visited { text-decoration: none; }
.topnav > a:hover { background-color: #009688 !important; }
.topnav svg { background-color: inherit !important;height: 1.3em; }
#site-search {
  display: none;
  width: 175px;
  padding: 0.1em 0.2em;
}
#search-btn {
  all: unset;
  vertical-align: middle;
  cursor: pointer;
  background-color: transparent !important;
}
#search-btn svg {
  width: 12px;
  height: 12px;
  fill: white;
}
@media (min-width:800px) {
  #site-search {
    display: inline-block;
    width: 20vw;
    padding: 5px 10px;
  }
  #search-btn {
    position: relative;
    top: 3px;
    right: 30px;
  }
  #search-btn svg {
    height: 22px;
    width: 22px;
    fill: black;
  }
}
#site-s-result {
  background-color: white !important;
  display: none;
  position: absolute;
  z-index: 10;
  left: 0;
  top: 0;
}
#site-s-result > * {
  width: 100%;
  padding: 0.7em 2em;
  color: black !important;
  background-color: transparent !important;
}
#site-s-result > *:hover {
  background-color: #e7e7e7 !important;
  color: black !important;
}

input[type=text], select, textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc !important;
  border-radius: 4px;
  resize: vertical;
}
label {
  padding: 12px 12px 12px 0;
  display: inline-block;
}
input[type=submit] {
  background-color: #04AA6D !important;
  color: white !important;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  float: right;
}
input[type=submit]:hover {
  background-color: #45a049 !important;
}
.col-25 {
  float: left;
  width: 25%;
  margin-top: 6px;
}
.col-75 {
  float: left;
  width: 75%;
  margin-top: 6px;
}
.row::after {
  content: "";
  display: table;
  clear: both;
}
input[type=button] {
	margin: 1vw;
  background-color: #04AA6D !important;
  color: white !important;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  float: right;
}
input[type=button]:hover {
  background-color: #45a049 !important;
}
input[type=range] {
	width: 95%;
}
</style></head><body><div class=topnav><a href=/index.html>主頁</a><a href=/search.html>貓咪</a><a href=/esearch.html>敵人</a><a href=/gachas.html>轉蛋</a><a href=/stage.html>關卡</a><a href=/music.html>音效</a><a href=/reward_all.html>獎勵</a><a title=設定 href=/settings.html style="float: right;"><svg viewbox="0 0 24 24"><path fill=white d="M20.1 9.2214C18.29 9.2214 17.55 7.9414 18.45 6.3714C18.97 5.4614 18.66 4.3014 17.75 3.7814L16.02 2.7914C15.23 2.3214 14.21 2.6014 13.74 3.3914L13.63 3.5814C12.73 5.1514 11.25 5.1514 10.34 3.5814L10.23 3.3914C9.78 2.6014 8.76 2.3214 7.97 2.7914L6.24 3.7814C5.33 4.3014 5.02 5.4714 5.54 6.3814C6.45 7.9414 5.71 9.2214 3.9 9.2214C2.86 9.2214 2 10.0714 2 11.1214V12.8814C2 13.9214 2.85 14.7814 3.9 14.7814C5.71 14.7814 6.45 16.0614 5.54 17.6314C5.02 18.5414 5.33 19.7014 6.24 20.2214L7.97 21.2114C8.76 21.6814 9.78 21.4014 10.25 20.6114L10.36 20.4214C11.26 18.8514 12.74 18.8514 13.65 20.4214L13.76 20.6114C14.23 21.4014 15.25 21.6814 16.04 21.2114L17.77 20.2214C18.68 19.7014 18.99 18.5314 18.47 17.6314C17.56 16.0614 18.3 14.7814 20.11 14.7814C21.15 14.7814 22.01 13.9314 22.01 12.8814V11.1214C22 10.0814 21.15 9.2214 20.1 9.2214ZM12 15.2514C10.21 15.2514 8.75 13.7914 8.75 12.0014C8.75 10.2114 10.21 8.7514 12 8.7514C13.79 8.7514 15.25 10.2114 15.25 12.0014C15.25 13.7914 13.79 15.2514 12 15.2514Z"/></svg></a><a title=佈景主題 onclick=toggleTheme() style="float: right;"><svg viewbox="0 0 24 24"><path fill=white d="M12,22 C17.5228475,22 22,17.5228475 22,12 C22,6.4771525 17.5228475,2 12,2 C6.4771525,2 2,6.4771525 2,12 C2,17.5228475 6.4771525,22 12,22 Z M12,20 L12,4 C16.418278,4 20,7.581722 20,12 C20,16.418278 16.418278,20 12,20 Z"></path></svg></a><a style="position: relative;float: right;"><input autocomplete=off id=site-search type=text name=search style="font-size: 17px;border: 1px solid rgba(0, 0, 0, 0.25) !important;border-radius: 25px;font-style: italic;background-color: white !important;color: black !important;" placeholder=Search... aria-label=search><button id=search-btn onclick=site_search()><svg viewbox="0 0 50 50" width=50px height=50px><path d="M 21 3 C 11.621094 3 4 10.621094 4 20 C 4 29.378906 11.621094 37 21 37 C 24.710938 37 28.140625 35.804688 30.9375 33.78125 L 44.09375 46.90625 L 46.90625 44.09375 L 33.90625 31.0625 C 36.460938 28.085938 38 24.222656 38 20 C 38 10.621094 30.378906 3 21 3 Z M 21 5 C 29.296875 5 36 11.703125 36 20 C 36 28.296875 29.296875 35 21 35 C 12.703125 35 6 28.296875 6 20 C 6 11.703125 12.703125 5 21 5 Z"/></svg></button><div style="position: relative;" class=w3-card><div id=site-s-result><div onclick="_s_open('/search.html?q=')">搜尋貓咪</div><div onclick="_s_open('/esearch.html?q=')">搜尋敵人</div><div onclick="_s_open('/stage.html?q=')">搜尋關卡</div></div></div></a></div><script src=/dracula.js></script><h1 style="text-align: center;">關卡字型</h1><form name="font settings" onsubmit="return false();" style="margin: 2vw;"><div class=row><div class=col-25><label for=lineWidth>Line width(邊框線寬度):</label></div><div class=col-75><input type=range min=0 max=10 step=0.1 name=lineWidth id=lineWidth value=3></div></div><div class=row><div class=col-25><label for=strokeColor>Stroke color(邊框顏色):</label></div><div class=col-75><input type=color name=strokeColor id=strokeColor value=#000000></div></div><div class=row><div class=col-25><label for=fontSize>Font size(字型大小):</label></div><div class=col-75><input type=range min=2 max=270 name=fontSize id=fontSize value=100></div></div><div class=row><div class=col-25><label for=startG>開始漸層</label></div><div class=col-75><input type=color name=startG id=startG value=#fff500></div></div><div class=row><div class=col-25><label for=endG>結束漸層:</label></div><div class=col-75><input type=color name=endG id=endG value=#ec9c00></div></div><div class=row><div class=col-25><label for=fontFamily>字型</label></div><div class=col-75><input type=text name=endG id=fontFamily value=StageFont></div></div><div class=row><div class=col-25><label for=bg>背景</label></div><div class=col-75><input type=color name=bg id=bg value=#ffffff></div></div><div class=row><div class=col-25><label for=text>文字</label></div><div class=col-75><input type=text name=text id=text value="The Battle Cats"></div></div><div class=row><input type=button onclick=download(event) value=下載></div></form><canvas id=canvas style="display: block;padding: 0;margin: 1vh auto;width: 98vw;height: max(100px, 30vh);border: 1px solid gray;"></canvas><script>

const lineWidth   = document.getElementById('lineWidth');
const fontSize    = document.getElementById('fontSize');
const startG      = document.getElementById('startG');
const endG        = document.getElementById('endG');
const fontFamily  = document.getElementById('fontFamily');
const strokeColor = document.getElementById('strokeColor');
const bg = document.getElementById('bg');
const text = document.getElementById('text');

const c = document.getElementById("canvas");
var ctx = c.getContext("2d");

function setStyles(fill) {
  if (fill) {
	ctx.fillStyle = bg.value;
  	ctx.fillRect(0, 0, c.width, c.height);
  }
  var gradient = ctx.createLinearGradient(0, 0, 0, parseInt(fontSize.value) * 0.76);
  gradient.addColorStop("0", startG.value);
  gradient.addColorStop("1.0", endG.value);
  ctx.fillStyle = gradient;
  ctx.strokeStyle = strokeColor.value;
  ctx.lineWidth = lineWidth.value;
  ctx.font = fontSize.value + 'px "' + fontFamily.value + '"';
}
function measureText() {
  	ctx.clearRect(0, 0, c.width, c.height);
  	setStyles(false);
  	ctx.strokeStyle = '#000000FF';
  	const w = c.width;
  	const h = c.height;
	ctx.fillText(text.value, w / 2, h / 2);
	ctx.strokeText(text.value, w / 2, h / 2);
	ctx.fill();
	ctx.stroke();
  	var left = -1, right = -1, top = -1, buttom = -1;

  	const data = ctx.getImageData(0, 0, w, h);
  	const raw = data.data;
  	const wh = w * h * 4;
  	const w4 = 4 * w;

  	for (let i = 3;i < wh;i += 4) {
  		if (raw[i]) {
  			top = ~~(i / w4);
  			break;
  		}
  	}

  	for (let i = wh - 1;i >= 0;i -= 4) {
  		if (raw[i]) {
  			buttom = ~~(i / w4);
  			break;
  		}
  	}

  	o1: for (let x = 0;x < w;++x) {
  		const end = wh - (w - x) * 4;
  		for (let i = x * 4 + 3;i < end;i += w4) {
  			if (raw[i]) {
  				left = x;
  				break o1;
  			}
  		}
  	}

  	o2: for (let x = w - 1;x >= 0;--x) {
  		const end = wh - (w - x) * 4;
  		for (let i = x * 4 + 3;i < end;i += w4) {
  			if (raw[i]) {
  				right = x;
  				break o2;
  			}
  		}
  	}

  	return {
  		'data': data,
  		'left': left, 
  		'right': right,
  		'top': top, 
  		'buttom': buttom,
	};
}
function download(event) {
	event.preventDefault();

	const { data, left, right, top, buttom } = measureText();


	if (left < 0 || right < 0 || buttom < 0 || top < 0)
		return;

	if (left >= right || top >= buttom)
		return;

	const canvas = document.createElement('canvas');

	canvas.width = right - left;
	canvas.height = buttom - top;

	const tx = canvas.getContext('2d');

	tx.putImageData(data, -left, -top, left, top, canvas.width, canvas.height);

	canvas.toBlob(blob => {
	  const url = URL.createObjectURL(blob);
	  const a = document.createElement('a');
	  a.href = url;
	  a.download = 'stage image - ' + text.value.slice(0, 20);
	  a.click();
	  URL.revokeObjectURL(url);
	});

	return false;
}

function drawFont() {
  setStyles(true);
  const x = c.width / 2;
  const y = 0;
  ctx.fillText(text.value, x, y);
  ctx.strokeText(text.value, x, y);
  ctx.fill();
  ctx.stroke();
}
let stF;
if (window.FontFace)
	stF = new FontFace('StageFont', 'url(stage_font.otf)');
else {
	stF = {};
	var s = document.createElement('style');
	s.textContent = "@font-face { font-family: StageFont; src: url('stage_font.otf') format('opentype');";
	document.head.appendChild(s);
	stF.load = function() {
		return Promise.resolve(undefined);
	}
}
stF.load().then(font => {
	font && document.fonts.add(font);
	(onresize = function() {
		const dpr = (window.devicePixelRatio || 1);
		c.height = Math.round(c.clientHeight * dpr);
		c.width = Math.round(c.clientWidth * dpr);
		ctx.lineCap = "round";
		ctx.lineJoin = "round";
		ctx.textBaseline = 'top';
		ctx.textAlign = 'center';
		drawFont();
	})();
});
text.oninput = bg.oninput = lineWidth.oninput = fontSize.oninput = startG.oninput = endG.oninput = fontFamily.oninput = strokeColor.oninput = drawFont;
</script></body></html>