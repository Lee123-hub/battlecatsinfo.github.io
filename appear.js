const url=new URL(location.href);let q_id=url.searchParams.get("id");if(!q_id)throw alert("Missing id in URL query"),"";if((q_id=parseInt(q_id))<0||isNaN(q_id))throw alert("Invalid Enemy id!"),"";const img=document.getElementById("eicon"),ss=t3str(q_id),main_div=(img.src="https://battlecatsinfo.github.io/img/e/"+ss+"/enemy_icon_"+ss+".png",img.onerror=function(){this.onerror=null,this.src="https://battlecatsinfo.github.io/img/e/"+ss+"/edi_"+ss+".png"},document.getElementById("main"));var Buffer=BrowserFS.BFSRequire("buffer").Buffer;const materialDrops=[85,86,87,88,89,90,91,140,187,188,189,190,191,192,193,194];function t3str(x){var s=x.toString();switch(s.length){case 2:return"0"+s;case 1:return"00"+s}return s}function loadStage(){return new Promise(resolve=>{var req=indexedDB.open("stage",5);req.onupgradeneeded=function(event){event=event.target.result;try{event.deleteObjectStore("data")}catch(e){}event.createObjectStore("data",{keyPath:"name"}).createIndex("data","",{unique:!1})},req.onsuccess=function(event){const db=event.target.result;db.transaction("data").objectStore("data").get("stages").onsuccess=function(event){event=event.target.result;if(event)return resolve(event.data);fetch("/stages.zip").then(res=>res.arrayBuffer()).then(buffer=>{var tx=db.transaction(["data"],"readwrite");tx.objectStore("data").put({name:"stages",data:buffer}),tx.oncomplete=function(){db.close()},resolve(buffer)})}}})}function do_search(){const s1=fs.readdirSync("/stages");let num_results=0;for(let i=0;i<s1.length;++i){var d1=document.createElement("details"),m1=s1[i];if("group"!=m1){var i1=JSON.parse(fs.readFileSync(`/stages/${m1}/info`,"utf-8","r")),s2=fs.readdirSync("/stages/"+m1);for(let j=0;j<s2.length;++j){var d2=document.createElement("details"),m2=s2[j];if("info"!=m2){var i2=JSON.parse(fs.readFileSync(`/stages/${m1}/${m2}/info`,"utf-8","r")),s3=fs.readdirSync(`/stages/${m1}/`+m2);for(let k=0;k<s3.length;++k){var m3=s3[k];if("info"!=m3){var line,i3=JSON.parse(fs.readFileSync(`/stages/${m1}/${m2}/`+m3,"utf-8","r"));for(line of i3.l)if(line[0]==q_id){++num_results;var a=document.createElement("a");a.href="/stage.html?s="+[i,j,k].join("-"),a.innerHTML=[i3.name,i3.jpname].filter(x=>x).join("/"),d2.appendChild(a);break}}}if(d2.children.length){const s2=document.createElement("summary");s2.textContent=[i2.name,i2.jpname].filter(x=>x).join("/"),d2.appendChild(s2),d1.appendChild(d2)}}}if(d1.children.length){const s1=document.createElement("summary");s1.textContent=[i1.name,i1.jpname].filter(x=>x).join("/"),d1.appendChild(s1),main_div.appendChild(d1)}}}num_results||(main_div.innerHTML=main_div.innerHTML+"<h1>沒有結果</h1>")}BrowserFS.install(window),loadStage().then(function(zipData){BrowserFS.configure({fs:"ZipFS",options:{zipData:Buffer.from(zipData)}},function(e){e?console.error(e):((fs=BrowserFS.BFSRequire("fs")).readdirSync("/stages"),main_div.style.display="block",setTimeout(do_search,0))})});